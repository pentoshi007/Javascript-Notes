# 🌐 6. JavaScript in the Browser - DOM and Events Fundamentals

> **Ultimate DOM Manipulation Guide** - Master browser interactions, events, and dynamic web development

---

## 🎯 What You'll Learn

```
🎮 Interactive Web Development:
┌─────────────────────────────────────────────────────────────┐
│ • DOM Selection & Manipulation                              │
│ • Event Handling & User Interactions                       │
│ • Dynamic Styling & CSS Classes                            │
│ • Real-World Projects (3 Complete Games!)                  │
│ • Best Practices & Code Organization                       │
└─────────────────────────────────────────────────────────────┘
```

---

## 🏗️ Understanding the DOM

### What is the DOM?

```
🌳 DOM Tree Structure:
┌─────────────────────────────────────────────────────────────┐
│                    Document                                 │
│                       │                                     │
│                    <html>                                   │
│                   ┌───┴───┐                                │
│                <head>   <body>                             │
│                   │       │                               │
│               <title>   <div>                             │
│                           │                               │
│                      <p> <button>                        │
└─────────────────────────────────────────────────────────────┘
```

**DOM (Document Object Model):** Structured representation of HTML documents that allows JavaScript to access and manipulate HTML elements and styles.

**Key Points:**
- DOM is NOT JavaScript - it's a Web API
- Creates a tree-like structure of all HTML elements
- Allows dynamic content changes without page reload
- Bridge between HTML/CSS and JavaScript

### DOM vs JavaScript

```javascript
// ❌ This is NOT JavaScript syntax
document.querySelector('.message');

// ✅ This is a Web API method available in browsers
// JavaScript can use DOM APIs when running in browser environment

console.log("This is pure JavaScript"); 
// Output: This is pure JavaScript

console.log(document.querySelector('.message')); 
// Output: <p class="message">Start guessing...</p>
```

**Important Distinction:**
- **JavaScript:** The programming language
- **DOM APIs:** Browser-provided methods to interact with HTML
- **Web APIs:** Additional browser features (DOM, Fetch, etc.)

---

## 🎯 Selecting and Manipulating Elements

### Basic DOM Selection

```javascript
// Selecting elements by class (most common)
const messageElement = document.querySelector('.message');
console.log(messageElement);
// Output: <p class="message">Start guessing...</p>

// Selecting by ID (alternative method)
const scoreElement = document.getElementById('score--0');
console.log(scoreElement);
// Output: <span id="score--0">20</span>

// Selecting multiple elements
const allButtons = document.querySelectorAll('.btn');
console.log(allButtons);
// Output: NodeList(3) [button.btn, button.btn, button.btn]

// Selecting by tag name
const allParagraphs = document.getElementsByTagName('p');
console.log(allParagraphs.length);
// Output: 4
```

### Reading and Changing Content

```javascript
// Reading text content
const message = document.querySelector('.message');
console.log(message.textContent);
// Output: "Start guessing..."

// Changing text content
message.textContent = '🎉 Correct Number!';
console.log(message.textContent);
// Output: "🎉 Correct Number!"

// Working with numbers
const scoreElement = document.querySelector('.score');
console.log(scoreElement.textContent);
// Output: "20"

scoreElement.textContent = 15;
console.log(scoreElement.textContent);
// Output: "15"
```

### Working with Input Values

```javascript
// HTML: <input type="number" class="guess" />

// Reading input value
const guessInput = document.querySelector('.guess');
console.log(guessInput.value);
// Output: "" (empty string initially)

// Setting input value
guessInput.value = 10;
console.log(guessInput.value);
// Output: "10" (always returns string!)

// Converting to number
const guessNumber = Number(guessInput.value);
console.log(guessNumber, typeof guessNumber);
// Output: 10 "number"
```

**Important Notes:**
- `.textContent` for reading/setting text
- `.value` for input field values
- Input values are always strings - convert with `Number()`
- Use `.` for classes, `#` for IDs in selectors

---

## 🎮 PROJECT #1: Guess My Number Game

### Setting Up the Game

```javascript
'use strict';

// Game state variables
let secretNumber = Math.trunc(Math.random() * 20) + 1;
let score = 20;
let highScore = 0;

// Initial setup
document.querySelector('.message').textContent = 'Start guessing...';
document.querySelector('.score').textContent = score;
document.querySelector('.number').textContent = '?';

console.log('Secret number:', secretNumber);
// Output: Secret number: 14 (random each time)
```

### Implementing Event Listeners

```javascript
// Event listener for check button
document.querySelector('.check').addEventListener('click', function() {
    // Get user input
    const guess = Number(document.querySelector('.guess').value);
    console.log('User guess:', guess, typeof guess);
    // Output: User guess: 12 "number"
    
    // Validate input
    if (!guess) {
        document.querySelector('.message').textContent = '🚫 No Number!';
        console.log('No input provided');
        // Output: No input provided
    }
});
```

### Complete Game Logic

```javascript
'use strict';

let secretNumber = Math.trunc(Math.random() * 20) + 1;
let score = 20;
let highScore = 0;

// Helper function for displaying messages
const displayMessage = function(message) {
    document.querySelector('.message').textContent = message;
};

document.querySelector('.check').addEventListener('click', function() {
    const guess = Number(document.querySelector('.guess').value);
    
    // No input
    if (!guess) {
        displayMessage('🚫 No Number!');
        
    // Player wins
    } else if (guess === secretNumber) {
        displayMessage('🎉 Correct Number!');
        document.querySelector('.number').textContent = secretNumber;
        
        // Update high score
        if (score > highScore) {
            highScore = score;
            document.querySelector('.highscore').textContent = highScore;
        }
        
        // Change styles for winning
        document.querySelector('body').style.backgroundColor = '#60b347';
        document.querySelector('.number').style.width = '30rem';
        
    // Guess is wrong
    } else if (guess !== secretNumber) {
        if (score > 1) {
            displayMessage(guess > secretNumber ? '📈 Too high!' : '📉 Too low!');
            score--;
            document.querySelector('.score').textContent = score;
        } else {
            displayMessage('💥 You lost the game!');
            document.querySelector('.score').textContent = 0;
        }
    }
});

// Reset game functionality
document.querySelector('.again').addEventListener('click', function() {
    score = 20;
    secretNumber = Math.trunc(Math.random() * 20) + 1;
    
    displayMessage('Start guessing...');
    document.querySelector('.score').textContent = score;
    document.querySelector('.number').textContent = '?';
    document.querySelector('.guess').value = '';
    
    // Reset styles
    document.querySelector('body').style.backgroundColor = '#222';
    document.querySelector('.number').style.width = '15rem';
});
```

**Game Flow Explanation:**
1. **Input Validation:** Check if user entered a number
2. **Win Condition:** Compare guess with secret number
3. **Feedback:** Provide hints (too high/low)
4. **Score Management:** Decrease score on wrong guesses
5. **Game Over:** End game when score reaches 0
6. **Reset:** Allow starting new game

---

## 🎨 Manipulating CSS Styles

### Changing Styles with JavaScript

```javascript
// Changing background color
document.querySelector('body').style.backgroundColor = '#60b347';
console.log(document.querySelector('body').style.backgroundColor);
// Output: "rgb(96, 179, 71)"

// Changing width
document.querySelector('.number').style.width = '30rem';
console.log(document.querySelector('.number').style.width);
// Output: "30rem"

// Changing multiple styles
const element = document.querySelector('.message');
element.style.color = '#eee';
element.style.fontSize = '2rem';
element.style.fontWeight = 'bold';

console.log('Color:', element.style.color);
console.log('Font size:', element.style.fontSize);
console.log('Font weight:', element.style.fontWeight);
// Output: Color: rgb(238, 238, 238)
//         Font size: 2rem
//         Font weight: bold
```

### Working with CSS Classes

```javascript
// Adding classes
const modal = document.querySelector('.modal');
modal.classList.add('hidden');
console.log(modal.classList);
// Output: DOMTokenList(2) ["modal", "hidden"]

// Removing classes
modal.classList.remove('hidden');
console.log(modal.classList.contains('hidden'));
// Output: false

// Toggling classes (add if not present, remove if present)
modal.classList.toggle('active');
console.log(modal.classList.contains('active'));
// Output: true

modal.classList.toggle('active');
console.log(modal.classList.contains('active'));
// Output: false

// Checking if class exists
if (modal.classList.contains('hidden')) {
    console.log('Modal is hidden');
} else {
    console.log('Modal is visible');
}
// Output: Modal is visible
```

---

## 🪟 PROJECT #2: Modal Window

### HTML Structure
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Modal Window</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <button class="show-modal">Show modal 1</button>
    <button class="show-modal">Show modal 2</button>
    <button class="show-modal">Show modal 3</button>
    
    <div class="modal hidden">
        <button class="close-modal">&times;</button>
        <h1>I'm a modal window 😍</h1>
        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit.</p>
    </div>
    <div class="overlay hidden"></div>
    
    <script src="script.js"></script>
</body>
</html>
```

### Modal Implementation

```javascript
'use strict';

// Selecting elements
const modal = document.querySelector('.modal');
const overlay = document.querySelector('.overlay');
const btnCloseModal = document.querySelector('.close-modal');
const btnsOpenModal = document.querySelectorAll('.show-modal');

console.log('Modal element:', modal);
// Output: <div class="modal hidden">...</div>

console.log('Number of open buttons:', btnsOpenModal.length);
// Output: Number of open buttons: 3

// Function to open modal
const openModal = function() {
    console.log('Opening modal...');
    modal.classList.remove('hidden');
    overlay.classList.remove('hidden');
};

// Function to close modal
const closeModal = function() {
    console.log('Closing modal...');
    modal.classList.add('hidden');
    overlay.classList.add('hidden');
};

// Add event listeners to all open buttons
for (let i = 0; i < btnsOpenModal.length; i++) {
    btnsOpenModal[i].addEventListener('click', openModal);
    console.log(`Added listener to button ${i + 1}`);
}
// Output: Added listener to button 1
//         Added listener to button 2
//         Added listener to button 3

// Close modal events
btnCloseModal.addEventListener('click', closeModal);
overlay.addEventListener('click', closeModal);

// Keyboard event for ESC key
document.addEventListener('keydown', function(e) {
    console.log('Key pressed:', e.key);
    
    if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        console.log('Closing modal with ESC key');
        closeModal();
    }
});
```

### Understanding Event Objects

```javascript
// Event object contains information about the event
document.addEventListener('keydown', function(event) {
    console.log('Event object:', event);
    console.log('Key pressed:', event.key);
    console.log('Key code:', event.code);
    console.log('Ctrl pressed:', event.ctrlKey);
    console.log('Shift pressed:', event.shiftKey);
});

// Example outputs when pressing different keys:
// Pressing 'A': Key pressed: a
// Pressing 'Enter': Key pressed: Enter
// Pressing 'Escape': Key pressed: Escape
// Pressing 'Ctrl+A': Key pressed: a, Ctrl pressed: true
```

**Key Concepts:**
- **Global Events:** Keyboard events are listened on `document`
- **Event Object:** Contains detailed information about the event
- **Multiple Listeners:** Same function can be attached to multiple elements
- **Class Manipulation:** More flexible than direct style changes

---

## 🎲 PROJECT #3: Pig Game

### Game Rules & Setup

```
🎲 Pig Game Rules:
┌─────────────────────────────────────────────────────────────┐
│ • Two players take turns rolling a dice                    │
│ • Add dice value to current score (unless roll 1)          │
│ • Rolling 1: Lose current score, switch players            │
│ • Hold: Add current to total score, switch players         │
│ • First to 100 points wins!                                │
└─────────────────────────────────────────────────────────────┘
```

### Initial Setup

```javascript
'use strict';

// Selecting elements
const player0El = document.querySelector('.player--0');
const player1El = document.querySelector('.player--1');
const score0El = document.querySelector('#score--0');
const score1El = document.getElementById('score--1');
const current0El = document.getElementById('current--0');
const current1El = document.getElementById('current--1');

const diceEl = document.querySelector('.dice');
const btnNew = document.querySelector('.btn--new');
const btnRoll = document.querySelector('.btn--roll');
const btnHold = document.querySelector('.btn--hold');

// Game state variables
let scores, currentScore, activePlayer, playing;

// Initialize game
const init = function() {
    scores = [0, 0];
    currentScore = 0;
    activePlayer = 0;
    playing = true;
    
    // Reset display
    score0El.textContent = 0;
    score1El.textContent = 0;
    current0El.textContent = 0;
    current1El.textContent = 0;
    
    // Hide dice and reset classes
    diceEl.classList.add('hidden');
    player0El.classList.remove('player--winner');
    player1El.classList.remove('player--winner');
    player0El.classList.add('player--active');
    player1El.classList.remove('player--active');
    
    console.log('Game initialized');
    console.log('Scores:', scores);
    console.log('Active player:', activePlayer);
};

init();
```

### Rolling Dice Functionality

```javascript
// Switch player function
const switchPlayer = function() {
    document.getElementById(`current--${activePlayer}`).textContent = 0;
    currentScore = 0;
    activePlayer = activePlayer === 0 ? 1 : 0;
    
    // Toggle active class between players
    player0El.classList.toggle('player--active');
    player1El.classList.toggle('player--active');
    
    console.log(`Switched to player ${activePlayer + 1}`);
};

// Roll dice event
btnRoll.addEventListener('click', function() {
    if (playing) {
        // 1. Generate random dice roll
        const dice = Math.trunc(Math.random() * 6) + 1;
        console.log(`Player ${activePlayer + 1} rolled:`, dice);
        
        // 2. Display dice
        diceEl.classList.remove('hidden');
        diceEl.src = `dice-${dice}.png`;
        
        // 3. Check for rolled 1
        if (dice !== 1) {
            // Add dice to current score
            currentScore += dice;
            document.getElementById(`current--${activePlayer}`).textContent = currentScore;
            console.log(`Current score: ${currentScore}`);
        } else {
            // Switch to next player
            console.log('Rolled 1! Switching player...');
            switchPlayer();
        }
    }
});
```

### Hold Score & Win Condition

```javascript
btnHold.addEventListener('click', function() {
    if (playing) {
        // 1. Add current score to active player's total
        scores[activePlayer] += currentScore;
        document.getElementById(`score--${activePlayer}`).textContent = scores[activePlayer];
        
        console.log(`Player ${activePlayer + 1} total score:`, scores[activePlayer]);
        
        // 2. Check if player won (score >= 100)
        if (scores[activePlayer] >= 100) {
            // Finish the game
            playing = false;
            diceEl.classList.add('hidden');
            
            document.querySelector(`.player--${activePlayer}`).classList.add('player--winner');
            document.querySelector(`.player--${activePlayer}`).classList.remove('player--active');
            
            console.log(`🎉 Player ${activePlayer + 1} wins with ${scores[activePlayer]} points!`);
        } else {
            // Switch to next player
            switchPlayer();
        }
    }
});

// New game button
btnNew.addEventListener('click', init);
```

### Complete Game State Management

```javascript
// Example game flow with console outputs:

// Initial state
console.log('=== GAME START ===');
// Output: === GAME START ===

// Player 1 rolls 4
console.log('Player 1 rolls: 4, Current: 4');
// Output: Player 1 rolls: 4, Current: 4

// Player 1 rolls 6
console.log('Player 1 rolls: 6, Current: 10');
// Output: Player 1 rolls: 6, Current: 10

// Player 1 holds
console.log('Player 1 holds, Total: 10');
console.log('Switching to Player 2');
// Output: Player 1 holds, Total: 10
//         Switching to Player 2

// Player 2 rolls 1
console.log('Player 2 rolls: 1, Lost turn!');
console.log('Switching to Player 1');
// Output: Player 2 rolls: 1, Lost turn!
//         Switching to Player 1

// Continue until someone reaches 100...
```

**Game State Variables:**
- `scores[]`: Array holding total scores for both players
- `currentScore`: Temporary score for current turn
- `activePlayer`: Index (0 or 1) of current player
- `playing`: Boolean to control if game is active

---

## 🔧 Advanced DOM Techniques

### Event Delegation

```javascript
// Instead of adding listeners to each button individually
const buttons = document.querySelectorAll('.btn');
buttons.forEach(btn => {
    btn.addEventListener('click', handleClick);
});

// Use event delegation on parent element
document.querySelector('.button-container').addEventListener('click', function(e) {
    if (e.target.classList.contains('btn')) {
        console.log('Button clicked:', e.target.textContent);
        handleClick(e);
    }
});
```

### Dynamic Element Creation

```javascript
// Creating new elements
const newButton = document.createElement('button');
newButton.textContent = 'New Button';
newButton.classList.add('btn', 'btn--new');

// Adding to DOM
document.querySelector('.container').appendChild(newButton);

console.log('New button created and added');
// Output: New button created and added

// Removing elements
const oldButton = document.querySelector('.old-btn');
if (oldButton) {
    oldButton.remove();
    console.log('Old button removed');
}
```

### Working with Data Attributes

```html
<!-- HTML with data attributes -->
<button data-player="1" data-action="roll" class="btn">Roll Dice</button>
```

```javascript
// Reading data attributes
const button = document.querySelector('.btn');
console.log('Player:', button.dataset.player);
console.log('Action:', button.dataset.action);
// Output: Player: 1
//         Action: roll

// Setting data attributes
button.dataset.score = '50';
console.log('Score:', button.dataset.score);
// Output: Score: 50
```

---

## 🎯 Best Practices & Code Organization

### DRY Principle (Don't Repeat Yourself)

```javascript
// ❌ Repetitive code
document.querySelector('.message').textContent = '🎉 Correct!';
document.querySelector('.message').textContent = '📈 Too high!';
document.querySelector('.message').textContent = '📉 Too low!';

// ✅ DRY solution
const displayMessage = function(message) {
    document.querySelector('.message').textContent = message;
};

displayMessage('🎉 Correct!');
displayMessage('📈 Too high!');
displayMessage('📉 Too low!');
```

### State Management

```javascript
// ✅ Good: Keep state in variables
let gameState = {
    score: 20,
    secretNumber: Math.trunc(Math.random() * 20) + 1,
    highScore: 0,
    isPlaying: true
};

// Update DOM from state
const updateDisplay = function() {
    document.querySelector('.score').textContent = gameState.score;
    document.querySelector('.highscore').textContent = gameState.highScore;
};

// ❌ Bad: Reading state from DOM
const currentScore = Number(document.querySelector('.score').textContent);
```

### Event Handler Organization

```javascript
// ✅ Organized event handlers
const gameHandlers = {
    checkGuess: function() {
        const guess = Number(document.querySelector('.guess').value);
        // Game logic here
    },
    
    resetGame: function() {
        // Reset logic here
    },
    
    updateHighScore: function() {
        // High score logic here
    }
};

// Attach handlers
document.querySelector('.check').addEventListener('click', gameHandlers.checkGuess);
document.querySelector('.again').addEventListener('click', gameHandlers.resetGame);
```

---

## 🐛 Common DOM Manipulation Mistakes

### 1. Forgetting to Convert Strings

```javascript
// ❌ Wrong: Comparing string with number
const userInput = document.querySelector('.input').value; // "5"
if (userInput === 5) { // false! "5" !== 5
    console.log('Match!');
}

// ✅ Correct: Convert to number first
const userInput = Number(document.querySelector('.input').value); // 5
if (userInput === 5) { // true! 5 === 5
    console.log('Match!');
}
```

### 2. Not Checking if Element Exists

```javascript
// ❌ Dangerous: Element might not exist
document.querySelector('.nonexistent').textContent = 'Hello';
// Error: Cannot read property 'textContent' of null

// ✅ Safe: Check before using
const element = document.querySelector('.maybe-exists');
if (element) {
    element.textContent = 'Hello';
    console.log('Element updated');
} else {
    console.log('Element not found');
}
```

### 3. Inefficient DOM Queries

```javascript
// ❌ Inefficient: Querying same element multiple times
document.querySelector('.message').textContent = 'Loading...';
document.querySelector('.message').style.color = 'blue';
document.querySelector('.message').classList.add('loading');

// ✅ Efficient: Query once, store reference
const messageEl = document.querySelector('.message');
messageEl.textContent = 'Loading...';
messageEl.style.color = 'blue';
messageEl.classList.add('loading');
```

---

## 🎯 Key Takeaways

```
🏆 DOM Mastery Checklist:
┌─────────────────────────────────────────────────────────────┐
│ ✅ Understand DOM structure and Web APIs                   │
│ ✅ Master element selection methods                        │
│ ✅ Handle user events effectively                          │
│ ✅ Manipulate content and styles dynamically              │
│ ✅ Organize code with functions and state management       │
│ ✅ Follow best practices and avoid common mistakes        │
└─────────────────────────────────────────────────────────────┘
```

**Essential DOM Methods:**
- `document.querySelector()` - Select single element
- `document.querySelectorAll()` - Select multiple elements
- `element.addEventListener()` - Handle events
- `element.classList` - Manage CSS classes
- `element.textContent` - Get/set text
- `element.value` - Get/set input values

**Remember:** The DOM is your gateway to creating interactive web experiences. Master these fundamentals, and you'll be able to build engaging, dynamic websites that respond to user actions in real-time!

---

## 🚀 Next Steps

1. **Practice Projects:** Build more interactive games and applications
2. **Advanced Events:** Learn about event bubbling, capturing, and delegation
3. **Performance:** Optimize DOM manipulations for better user experience
4. **Frameworks:** Understand how libraries like React build upon these concepts
5. **Accessibility:** Make your interactive elements accessible to all users

The DOM is the foundation of all modern web development - master it, and you'll have the power to bring any web design to life!